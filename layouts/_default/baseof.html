<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ block "title" . }}{{ .Title }} | bcachefs wiki{{ end }}</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="any" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  {{/* Bootstrap Icons via CDN for simple icon usage */}}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  {{/* Feed discovery for News section */}}
  {{ if and .IsSection (eq .Section "news") }}
  {{ with .OutputFormats.Get "RSS" }}
  <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }} â€” News RSS" href="{{ .Permalink }}" />
  {{ end }}
  {{ end }}
  {{/* Use Hugo Pipes to serve a single, fingerprinted stylesheet */}}
  {{ $css := resources.Get "css/main.css" | resources.Minify | resources.Fingerprint }}
  <link rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}" />
</head>

<body class="{{ if .IsHome }}home{{ end }}{{ if and (not .IsHome) .Section }} section-{{ .Section }}{{ end }}">
  <header class="site-header">
    <div class="container nav-inner">
      <h1 class="brand">
        {{ if .IsHome }}
          <span class="brand-label">bcachefs</span>
        {{ else }}
          <a class="brand-label" href="/">bcachefs</a>
        {{ end }}
      </h1>
      <input type="checkbox" id="nav-toggle" class="nav-toggle" aria-label="Toggle navigation" />
      <label for="nav-toggle" class="nav-burger" aria-controls="primary-navigation" aria-expanded="false">
        <span></span>
      </label>
      {{ $sec := .Section }}
      <nav id="primary-navigation" class="nav-left">
        {{/* Primary sections: Documentation (Using), Developers, Architecture, News */}}
        {{ if eq $sec "using" }}
        <span class="nav-item current">Documentation</span>
        {{ else }}
        <a class="nav-item" href='{{ relref . "using/_index.md" }}'>Documentation</a>
        {{ end }}

        {{ if eq $sec "developer" }}
        <span class="nav-item current">Developers</span>
        {{ else }}
        <a class="nav-item" href='{{ relref . "developer/_index.md" }}'>Developers</a>
        {{ end }}

        {{ if eq $sec "architecture" }}
        <span class="nav-item current">Architecture</span>
        {{ else }}
        <a class="nav-item" href='{{ relref . "architecture/_index.md" }}'>Architecture</a>
        {{ end }}

        {{ if eq $sec "news" }}
        <span class="nav-item current">News</span>
        {{ else }}
        <a class="nav-item" href='{{ relref . "news/_index.md" }}'>News</a>
        {{ end }}
      </nav>
      <div class="nav-right">
        <a class="aux-link" href='{{ relref . "using/support.md" }}'>Support</a>
        <a class="aux-link" href='{{ relref . "using/getting_started.md" }}'>Getting Started</a>
        <a class="patreon-bubble" href="https://www.patreon.com/bcachefs" target="_blank" rel="noopener noreferrer"
          aria-label="Support bcachefs on Patreon">Patreon</a>
      </div>
    </div>
  </header>
  {{ partial "emergency-banner.html" . }}
  {{ partial "breadcrumbs.html" . }}
  <main>
    <div class="container">
      {{ block "main" . }}{{ end }}
    </div>
  </main>
  {{/* Scrollspy for ToC: highlights current section and keeps sidebars informative */}}
  <script>
  (function(){
    // Collect ToC links from desktop sidebar and mobile dropdown content
    const tocContainers = Array.from(document.querySelectorAll('.sidenav-right .toc, .toc-mobile .toc-content'));
    if (!tocContainers.length) return;
    const links = tocContainers.flatMap(c => Array.from(c.querySelectorAll('a[href^="#"]')));
    if (!links.length) return;
    const byId = new Map(links.map(a => [decodeURIComponent(a.getAttribute('href').slice(1)), a]));
    const heads = Array.from(document.querySelectorAll('article h1, article h2, article h3'))
      .filter(h => byId.has(h.id));

    let activeId = null;
    const setActive = (id) => {
      if (activeId === id) return;
      links.forEach(a => a.classList.remove('active'));
      const el = byId.get(id);
      if (el) el.classList.add('active');
      activeId = id;
    };
    const obs = new IntersectionObserver((entries)=>{
      // pick the entry nearest to top that's intersecting
      const visible = entries
        .filter(e => e.isIntersecting)
        .sort((a,b)=> a.boundingClientRect.top - b.boundingClientRect.top);
      if (visible.length) setActive(visible[0].target.id);
    }, { rootMargin: '0px 0px -70% 0px', threshold: [0, 1] });
    heads.forEach(h => obs.observe(h));
    // Fallback: on hashchange, ensure link is marked
    window.addEventListener('hashchange', ()=>{
      const id = decodeURIComponent(location.hash.replace('#',''));
      if (id) setActive(id);
    });
  })();
  </script>
</body>

</html>
