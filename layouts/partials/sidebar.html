<div class="toc">
  {{ $toc := .TableOfContents }}
  {{ if and (not .IsHome) (in $toc "<li>") }}
    <h3>On this page</h3>
    {{ $toc }}
  {{ end }}
  </div>

{{/* In this section: show only on child pages (not on section landing), and only for real sections */}}
{{ if and .CurrentSection (not .IsSection) (ne .Section "") }}
  <div class="sectionlist">
    {{ with .CurrentSection }}
      {{ $cur := . }}
      <h3>In this section</h3>
      <ul>
        <li><a href="{{ $cur.RelPermalink }}">â†‘ {{ $cur.Title }}</a></li>
        {{ if eq $.Section "news" }}
          {{/* For news, list only neighbors (no arrows in labels) */}}
          {{ $pages := $cur.RegularPages.ByDate }}
          {{ $earlierPages := where $pages "Date" "lt" $.Date }}
          {{ $laterPages := where $pages "Date" "gt" $.Date }}
          {{ range first 1 $laterPages }}
            <li><a href="{{ .RelPermalink }}">Later: {{ .Title }}</a></li>
          {{ end }}
          {{ range last 1 $earlierPages }}
            <li><a href="{{ .RelPermalink }}">Earlier: {{ .Title }}</a></li>
          {{ end }}
        {{ else }}
          {{ $children := where .RegularPages "Draft" "ne" true }}
          {{ range $children.ByWeight }}
            <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
          {{ end }}
        {{ end }}
      </ul>
    {{ end }}
  </div>
{{ end }}

{{/* See Also: configurable per page; falls back to section-level */}}
{{ $see := .Params.see_also }}
{{ if not $see }}
  {{ with .CurrentSection }}
    {{ $see = .Params.see_also }}
  {{ end }}
{{ end }}
{{ with $see }}
  <div class="seealso">
    <h3>See also</h3>
    <ul>
      {{ range . }}
        {{/* Support objects: {title, ref|url}, or bare strings treated as ref */}}
        {{ $item := . }}
        {{ with $item.ref }}
          {{ $href := relref $ . }}
          {{ $title := (or $item.title (path.Base .)) }}
          <li><a href='{{ $href }}'>{{ $title }}</a></li>
        {{ else }}
          {{ with $item.url }}
            {{ $title := (or $item.title .) }}
            <li><a href='{{ . }}' rel='noopener'>{{ $title }}</a></li>
          {{ else }}
            <li><a href='{{ relref $ $item }}'>{{ $item }}</a></li>
          {{ end }}
        {{ end }}
      {{ end }}
    </ul>
  </div>
{{ end }}
